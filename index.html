<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Estoque de Perfumes</title>
    <script src="https://cdn.tailwindcss.com">
        // Salvar e carregar dados com localStorage
        function salvarDados() {
            localStorage.setItem('perfumes', JSON.stringify(perfumes));
            localStorage.setItem('vendas', JSON.stringify(vendas));
            localStorage.setItem('perfumeIdCounter', perfumeIdCounter.toString());
            localStorage.setItem('vendasIdCounter', vendasIdCounter.toString());
        }

        function carregarDados() {
            const perfumesSalvos = localStorage.getItem('perfumes');
            const vendasSalvas = localStorage.getItem('vendas');
            const perfumeId = localStorage.getItem('perfumeIdCounter');
            const vendasId = localStorage.getItem('vendasIdCounter');

            if (perfumesSalvos) perfumes = JSON.parse(perfumesSalvos);
            if (vendasSalvas) vendas = JSON.parse(vendasSalvas);
            
            // Validate counters after parsing
            if (perfumeId) {
                const parsedPerfumeId = parseInt(perfumeId);
                if (!isNaN(parsedPerfumeId)) {
                    perfumeIdCounter = parsedPerfumeId;
                }
            }
            
            if (vendasId) {
                const parsedVendasId = parseInt(vendasId);
                if (!isNaN(parsedVendasId)) {
                    vendasIdCounter = parsedVendasId;
                }
            }
        }

    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js">
        // Salvar e carregar dados com localStorage
        function salvarDados() {
            localStorage.setItem('perfumes', JSON.stringify(perfumes));
            localStorage.setItem('vendas', JSON.stringify(vendas));
            localStorage.setItem('perfumeIdCounter', perfumeIdCounter.toString());
            localStorage.setItem('vendasIdCounter', vendasIdCounter.toString());
        }

        function carregarDados() {
            const perfumesSalvos = localStorage.getItem('perfumes');
            const vendasSalvas = localStorage.getItem('vendas');
            const perfumeId = localStorage.getItem('perfumeIdCounter');
            const vendasId = localStorage.getItem('vendasIdCounter');

            if (perfumesSalvos) perfumes = JSON.parse(perfumesSalvos);
            if (vendasSalvas) vendas = JSON.parse(vendasSalvas);
            
            // Validate counters after parsing
            if (perfumeId) {
                const parsedPerfumeId = parseInt(perfumeId);
                if (!isNaN(parsedPerfumeId)) {
                    perfumeIdCounter = parsedPerfumeId;
                }
            }
            
            if (vendasId) {
                const parsedVendasId = parseInt(vendasId);
                if (!isNaN(parsedVendasId)) {
                    vendasIdCounter = parsedVendasId;
                }
            }
        }

    </script>
    <style>
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .transition-all {
            transition: all 0.3s ease;
        }
        .tab-active {
            background-color: #7c3aed;
            color: white;
        }
        .tab-inactive {
            background-color: #f3f4f6;
            color: #6b7280;
        }
        .form-section {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            background-color: #fafafa;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-50 to-pink-50">
    <div class="max-w-7xl mx-auto p-4">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center space-x-3">
                    <i data-feather="package" class="text-purple-600 w-8 h-8"></i>
                    <h1 class="text-3xl font-bold text-gray-800">Sistema de Perfumes</h1>
                </div>
                
                <!-- Tabs -->
                <div class="flex bg-gray-100 rounded-lg p-1">
                    <button onclick="switchTab('estoque')" id="tab-estoque" class="px-6 py-2 rounded-lg font-medium transition-colors tab-active">
                        <i data-feather="package" class="w-4 h-4 inline mr-2"></i>
                        Estoque
                    </button>
                    <button onclick="switchTab('vendas')" id="tab-vendas" class="px-6 py-2 rounded-lg font-medium transition-colors tab-inactive">
                        <i data-feather="shopping-cart" class="w-4 h-4 inline mr-2"></i>
                        Vendas
                    </button>
                </div>
            </div>
        </div>

        <!-- ESTOQUE TAB -->
        <div id="estoque-content">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center space-x-3">
                        <i data-feather="package" class="text-blue-600 w-8 h-8"></i>
                        <div>
                            <p class="text-gray-600">Total de Itens</p>
                            <p id="totalItems" class="text-2xl font-bold text-gray-800">20</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center space-x-3">
                        <i data-feather="dollar-sign" class="text-green-600 w-8 h-8"></i>
                        <div>
                            <p class="text-gray-600">Valor Total</p>
                            <p id="totalValue" class="text-2xl font-bold text-gray-800">R$ 8.300,00</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center space-x-3">
                        <i data-feather="shopping-cart" class="text-purple-600 w-8 h-8"></i>
                        <div>
                            <p class="text-gray-600">Produtos Cadastrados</p>
                            <p id="totalProducts" class="text-2xl font-bold text-gray-800">2</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Perfume Button -->
            <div class="mb-6">
                <button onclick="toggleAddForm()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors">
                    <i data-feather="plus" class="w-5 h-5"></i>
                    <span>Adicionar Perfume</span>
                </button>
            </div>

            <!-- Filters -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <input type="text" id="searchInput" placeholder="Buscar por nome ou marca..." 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                               onkeyup="filterPerfumes()">
                    </div>
                    <div>
                        <select id="categoryFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                onchange="filterPerfumes()">
                            <option value="Todos">Todos</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Feminino">Feminino</option>
                            <option value="Unissex">Unissex</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Add Perfume Form -->
            <div id="addForm" class="bg-white rounded-xl shadow-lg p-6 mb-6 hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Adicionar Novo Perfume</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <input type="text" id="newNome" placeholder="Nome do perfume" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    <input type="text" id="newMarca" placeholder="Marca" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    <input type="number" id="newPreco" placeholder="Preço (R$)" step="0.01" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    <input type="number" id="newEstoque" placeholder="Quantidade em estoque" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    <input type="number" id="newMl" placeholder="Volume (ml)" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    <select id="newCategoria" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="Feminino">Feminino</option>
                        <option value="Masculino">Masculino</option>
                        <option value="Unissex">Unissex</option>
                    </select>
                </div>
                <div class="mt-4">
                    <input type="file" id="newImagem" accept="image/*" onchange="previewImage()" class="mb-2">
                    <div id="imagePreview" class="hidden">
                        <img id="previewImg" src="" alt="Preview" class="w-24 h-24 object-cover rounded-lg">
                    </div>
                </div>
                <div class="flex space-x-4 mt-6">
                    <button onclick="addPerfume()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors">
                        Salvar
                    </button>
                    <button onclick="toggleAddForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-lg transition-colors">
                        Cancelar
                    </button>
                </div>
            </div>

            <!-- Perfumes Grid -->
            <div id="perfumesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <!-- Perfumes serão inseridos aqui pelo JavaScript -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="text-center py-12 hidden">
                <i data-feather="package" class="w-16 h-16 text-gray-400 mx-auto mb-4"></i>
                <p class="text-xl text-gray-600">Nenhum perfume encontrado</p>
                <p class="text-gray-500">Adicione alguns perfumes ao seu estoque ou ajuste os filtros</p>
            </div>
        </div>

        <!-- VENDAS TAB -->
        <div id="vendas-content" class="hidden">
            <!-- Sales Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center space-x-3">
                        <i data-feather="trending-up" class="text-green-600 w-8 h-8"></i>
                        <div>
                            <p class="text-gray-600">Vendas Hoje</p>
                            <p id="salesToday" class="text-2xl font-bold text-gray-800">R$ 0,00</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center space-x-3">
                        <i data-feather="dollar-sign" class="text-blue-600 w-8 h-8"></i>
                        <div>
                            <p class="text-gray-600">Total de Vendas</p>
                            <p id="totalSales" class="text-2xl font-bold text-gray-800">R$ 0,00</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center space-x-3">
                        <i data-feather="shopping-bag" class="text-purple-600 w-8 h-8"></i>
                        <div>
                            <p class="text-gray-600">Itens Vendidos</p>
                            <p id="itemsSold" class="text-2xl font-bold text-gray-800">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center space-x-3">
                        <i data-feather="users" class="text-orange-600 w-8 h-8"></i>
                        <div>
                            <p class="text-gray-600">Clientes</p>
                            <p id="totalCustomers" class="text-2xl font-bold text-gray-800">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nova Venda Form -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Nova Venda</h2>
                
                <!-- Produto e Quantidade -->
                <div class="form-section">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Produto</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Perfume</label>
                            <select id="saleProduct" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" onchange="calculateSaleTotal()">
                                <option value="">Selecione um perfume</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Quantidade</label>
                            <input type="number" id="saleQuantity" min="1" value="1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" onchange="calculateSaleTotal()">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Preço de Venda (R$)</label>
                            <input type="number" id="salePrice" step="0.01" placeholder="0,00" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" onchange="calculateSaleTotal()">
                        </div>
                    </div>
                </div>

                <!-- Dados do Cliente -->
                <div class="form-section">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Dados do Cliente</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo *</label>
                            <input type="text" id="customerName" placeholder="Nome completo do cliente" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Telefone/WhatsApp</label>
                            <input type="text" id="customerPhone" placeholder="(11) 99999-9999" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Instagram</label>
                            <input type="text" id="customerInstagram" placeholder="@usuario" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Postou no Instagram?</label>
                            <select id="postedInstagram" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="Não">Não</option>
                                <option value="Sim">Sim</option>
                                <option value="Vai postar">Vai postar</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email (opcional)</label>
                            <input type="email" id="customerEmail" placeholder="email@exemplo.com" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        </div>
                    </div>
                </div>

                <!-- Canal e Local de Venda -->
                <div class="form-section">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Canal e Local</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Canal de Venda</label>
                            <select id="salesChannel" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="Instagram">Instagram</option>
                                <option value="WhatsApp">WhatsApp</option>
                                <option value="Facebook">Facebook</option>
                                <option value="Loja Física">Loja Física</option>
                                <option value="Marketplace">Marketplace</option>
                                <option value="Indicação">Indicação</option>
                                <option value="Site">Site</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Local de Entrega/Venda</label>
                            <select id="deliveryLocation" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="Retirada na Loja">Retirada na Loja</option>
                                <option value="Entrega Local">Entrega Local</option>
                                <option value="Correios">Correios</option>
                                <option value="Transportadora">Transportadora</option>
                                <option value="Motoboy">Motoboy</option>
                                <option value="Encontro Presencial">Encontro Presencial</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Forma de Pagamento -->
                <div class="form-section">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Forma de Pagamento</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Forma de Pagamento</label>
                            <select id="paymentMethod" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" onchange="toggleCardFields()">
                                <option value="PIX">PIX</option>
                                <option value="Cartão de Crédito">Cartão de Crédito</option>
                                <option value="Cartão de Débito">Cartão de Débito</option>
                                <option value="Dinheiro">Dinheiro</option>
                                <option value="Transferência">Transferência</option>
                                <option value="Boleto">Boleto</option>
                            </select>
                        </div>
                        <div id="installmentsField" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Parcelas</label>
                            <select id="installments" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" onchange="calculateFinalTotal()">
                                <option value="1">1x</option>
                                <option value="2">2x</option>
                                <option value="3">3x</option>
                                <option value="4">4x</option>
                                <option value="5">5x</option>
                                <option value="6">6x</option>
                                <option value="7">7x</option>
                                <option value="8">8x</option>
                                <option value="9">9x</option>
                                <option value="10">10x</option>
                                <option value="11">11x</option>
                                <option value="12">12x</option>
                            </select>
                        </div>
                        <div id="feeField" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Taxa (%)</label>
                            <input type="number" id="cardFee" step="0.01" value="0" placeholder="0.00" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" onchange="calculateFinalTotal()">
                        </div>
                        <div id="finalTotalField" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Total Final</label>
                            <input type="text" id="finalTotal" readonly class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100">
                        </div>
                    </div>
                </div>

                <!-- Observações -->
                <div class="form-section">
                    <h3 class="text-lg font-semibold text-gray-700 mb-3">Observações</h3>
                    <textarea id="saleNotes" placeholder="Observações adicionais sobre a venda..." rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500"></textarea>
                </div>

                <!-- Total e Ações -->
                <div class="flex justify-between items-center pt-4 border-t">
                    <div class="text-lg font-semibold">
                        Subtotal: <span id="saleTotal" class="text-green-600">R$ 0,00</span>
                        <span id="totalWithFee" class="text-purple-600 ml-4 hidden"></span>
                    </div>
                    <div class="flex space-x-4">
                        <button onclick="clearSalesForm()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg transition-colors">
                            Limpar
                        </button>
                        <button onclick="processSale()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center space-x-2 transition-colors">
                            <i data-feather="shopping-cart" class="w-5 h-5"></i>
                            <span>Registrar Venda</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sales Filters -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <input type="text" id="salesSearchInput" placeholder="Buscar por cliente, perfume..." 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                               onkeyup="filterSales()">
                    </div>
                    <div>
                        <select id="salesChannelFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                onchange="filterSales()">
                            <option value="Todos">Todos os Canais</option>
                            <option value="Instagram">Instagram</option>
                            <option value="WhatsApp">WhatsApp</option>
                            <option value="Facebook">Facebook</option>
                            <option value="Loja Física">Loja Física</option>
                            <option value="Marketplace">Marketplace</option>
                            <option value="Indicação">Indicação</option>
                            <option value="Site">Site</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div>
                        <select id="paymentFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                onchange="filterSales()">
                            <option value="Todos">Todas as Formas</option>
                            <option value="PIX">PIX</option>
                            <option value="Cartão de Crédito">Cartão de Crédito</option>
                            <option value="Cartão de Débito">Cartão de Débito</option>
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="Transferência">Transferência</option>
                            <option value="Boleto">Boleto</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Sales List -->
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="p-6 border-b border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800">Histórico de Vendas</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Produto</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qtd</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Canal</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pagamento</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="salesTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Sales will be inserted here -->
                        </tbody>
                    </table>
                </div>
                <div id="emptySalesState" class="text-center py-12 hidden">
                    <i data-feather="shopping-cart" class="w-16 h-16 text-gray-400 mx-auto mb-4"></i>
                    <p class="text-xl text-gray-600">Nenhuma venda registrada</p>
                    <p class="text-gray-500">Registre sua primeira venda usando o formulário acima</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Sale Details Modal -->
    <div id="saleModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 m-4 max-w-2xl w-full max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Detalhes da Venda</h3>
                <button onclick="closeSaleModal()" class="text-gray-500 hover:text-gray-700">
                    <i data-feather="x" class="w-6 h-6"></i>
                </button>
            </div>
            <div id="saleModalContent">
                <!-- Content will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // Dados dos perfumes em memória
        let perfumes = [
            {
                id: 1,
                nome: 'Chanel N°5',
                marca: 'Chanel',
                preco: 450.00,
                estoque: 12,
                imagem: null,
                categoria: 'Feminino',
                ml: 100
            },
            {
                id: 2,
                nome: 'Sauvage',
                marca: 'Dior',
                preco: 380.00,
                estoque: 8,
                imagem: null,
                categoria: 'Masculino',
                ml: 100
            }
        ];

        // Dados das vendas em memória
        let vendas = [];

        let editingPerfume = null;
        let currentTab = 'estoque';
        let perfumeIdCounter = 3;
        let vendasIdCounter = 1;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            carregarDados();
            updateStats();
            renderPerfumes();
            updateSalesStats();
            renderSales();
            updateSalesProductOptions();
            feather.replace();
        });

        // Tab switching
        function switchTab(tab) {
            currentTab = tab;
            
            // Hide all tab contents
            document.getElementById('estoque-content').classList.add('hidden');
            document.getElementById('vendas-content').classList.add('hidden');
            
            // Remove active class from all tabs
            document.getElementById('tab-estoque').classList.remove('tab-active');
            document.getElementById('tab-estoque').classList.add('tab-inactive');
            document.getElementById('tab-vendas').classList.remove('tab-active');
            document.getElementById('tab-vendas').classList.add('tab-inactive');
            
            // Show selected tab content and mark as active
            document.getElementById(tab + '-content').classList.remove('hidden');
            document.getElementById('tab-' + tab).classList.remove('tab-inactive');
            document.getElementById('tab-' + tab).classList.add('tab-active');
            
            // Update UI elements
            if (tab === 'vendas') {
                updateSalesProductOptions();
            }
        }

        // Toggle add perfume form
        function toggleAddForm() {
            const form = document.getElementById('addForm');
            form.classList.toggle('hidden');
            
            if (!form.classList.contains('hidden')) {
                // Reset form when showing
                document.getElementById('newNome').value = '';
                document.getElementById('newMarca').value = '';
                document.getElementById('newPreco').value = '';
                document.getElementById('newEstoque').value = '';
                document.getElementById('newMl').value = '';
                document.getElementById('newCategoria').value = 'Feminino';
                document.getElementById('newImagem').value = '';
                document.getElementById('imagePreview').classList.add('hidden');
                editingPerfume = null;
            }
        }

        // Preview image before upload
        function previewImage() {
            const file = document.getElementById('newImagem').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').classList.remove('hidden');
                }
                reader.readAsDataURL(file);
            }
        }

        // Add or edit perfume
        function addPerfume() {
            const nome = document.getElementById('newNome').value.trim();
            const marca = document.getElementById('newMarca').value.trim();
            const precoValue = document.getElementById('newPreco').value;
            const estoqueValue = document.getElementById('newEstoque').value;
            const mlValue = document.getElementById('newMl').value;
            
            const preco = parseFloat(precoValue);
            const estoque = parseInt(estoqueValue);
            const ml = parseInt(mlValue);
            
            // Validate numeric inputs
            if (precoValue && isNaN(preco)) {
                alert('O preço deve ser um número válido');
                return;
            }
            
            if (estoqueValue && isNaN(estoque)) {
                alert('A quantidade em estoque deve ser um número válido');
                return;
            }
            
            if (mlValue && isNaN(ml)) {
                alert('O volume (ml) deve ser um número válido');
                return;
            }
            const categoria = document.getElementById('newCategoria').value;
            const imagemInput = document.getElementById('newImagem');
            
            // Basic validation
            if (!nome || !marca || isNaN(preco) || isNaN(estoque) || isNaN(ml)) {
                alert('Por favor, preencha todos os campos corretamente');
                return;
            }
            
            if (editingPerfume) {
                // Update existing perfume
                const index = perfumes.findIndex(p => p.id === editingPerfume);
                if (index !== -1) {
                    perfumes[index] = {
                        ...perfumes[index],
                        nome,
                        marca,
                        preco,
                        estoque,
                        ml,
                        categoria
                    };
                    
                    // Update image if new one was selected
                    if (imagemInput.files.length > 0) {
                        perfumes[index].imagem = URL.createObjectURL(imagemInput.files[0]);
                    }
                }
            } else {
                // Add new perfume
                const newPerfume = {
                    id: perfumeIdCounter++,
                    nome,
                    marca,
                    preco,
                    estoque,
                    ml,
                    categoria,
                    imagem: imagemInput.files.length > 0 ? URL.createObjectURL(imagemInput.files[0]) : null
                };
                perfumes.push(newPerfume);
            }
            
            // Update UI
            salvarDados();
            toggleAddForm();
            updateStats();
            renderPerfumes();
            updateSalesProductOptions();
        }

        // Edit perfume
        function editPerfume(id) {
            const perfume = perfumes.find(p => p.id === id);
            if (!perfume) return;
            
            editingPerfume = id;
            
            // Fill form with perfume data
            document.getElementById('newNome').value = perfume.nome;
            document.getElementById('newMarca').value = perfume.marca;
            document.getElementById('newPreco').value = perfume.preco;
            document.getElementById('newEstoque').value = perfume.estoque;
            document.getElementById('newMl').value = perfume.ml;
            document.getElementById('newCategoria').value = perfume.categoria;
            
            // Show image if exists
            if (perfume.imagem) {
                document.getElementById('previewImg').src = perfume.imagem;
                document.getElementById('imagePreview').classList.remove('hidden');
            } else {
                document.getElementById('imagePreview').classList.add('hidden');
            }
            
            // Show form if hidden
            document.getElementById('addForm').classList.remove('hidden');
            
            // Scroll to form
            document.getElementById('addForm').scrollIntoView({ behavior: 'smooth' });
        }

        // Delete perfume
        function deletePerfume(id) {
            if (confirm('Tem certeza que deseja excluir este perfume?')) {
                perfumes = perfumes.filter(p => p.id !== id);
                updateStats();
                renderPerfumes();
                updateSalesProductOptions();
            }
        }

        // Render perfumes grid
        function renderPerfumes() {
            const grid = document.getElementById('perfumesGrid');
            grid.innerHTML = '';
            
            if (perfumes.length === 0) {
                document.getElementById('emptyState').classList.remove('hidden');
                return;
            } else {
                document.getElementById('emptyState').classList.add('hidden');
            }
            
            perfumes.forEach(perfume => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-lg p-6 transition-all card-hover';
                
                let imageHtml = '<div class="bg-gray-100 rounded-lg w-full h-40 flex items-center justify-center mb-4">';
                if (perfume.imagem) {
                    imageHtml = `<img src="${perfume.imagem}" alt="${perfume.nome}" class="w-full h-40 object-cover rounded-lg mb-4">`;
                } else {
                    imageHtml += `<i data-feather="package" class="text-gray-400 w-12 h-12"></i></div>`;
                }
                
                card.innerHTML = `
                    ${imageHtml}
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-lg font-bold text-gray-800">${perfume.nome}</h3>
                        <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded">${perfume.categoria}</span>
                    </div>
                    <p class="text-gray-600 mb-1">${perfume.marca} - ${perfume.ml}ml</p>
                    <p class="text-lg font-bold text-purple-600 mb-4">R$ ${perfume.preco.toFixed(2).replace('.', ',')}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-sm ${perfume.estoque > 0 ? 'text-green-600' : 'text-red-600'}">
                            ${perfume.estoque > 0 ? `${perfume.estoque} em estoque` : 'Esgotado'}
                        </span>
                        <div class="flex space-x-2">
                            <button onclick="editPerfume(${perfume.id})" class="text-blue-600 hover:text-blue-800">
                                <i data-feather="edit" class="w-5 h-5"></i>
                            </button>
                            <button onclick="deletePerfume(${perfume.id})" class="text-red-600 hover:text-red-800">
                                <i data-feather="trash-2" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            feather.replace();
        }

        // Filter perfumes
        function filterPerfumes() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            
            const filtered = perfumes.filter(perfume => {
                const matchesSearch = perfume.nome.toLowerCase().includes(searchTerm) || 
                                     perfume.marca.toLowerCase().includes(searchTerm);
                const matchesCategory = category === 'Todos' || perfume.categoria === category;
                return matchesSearch && matchesCategory;
            });
            
            renderFilteredPerfumes(filtered);
        }

        // Render filtered perfumes
        function renderFilteredPerfumes(filteredPerfumes) {
            const grid = document.getElementById('perfumesGrid');
            grid.innerHTML = '';
            
            if (filteredPerfumes.length === 0) {
                document.getElementById('emptyState').classList.remove('hidden');
                return;
            } else {
                document.getElementById('emptyState').classList.add('hidden');
            }
            
            filteredPerfumes.forEach(perfume => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-lg p-6 transition-all card-hover';
                
                let imageHtml = '<div class="bg-gray-100 rounded-lg w-full h-40 flex items-center justify-center mb-4">';
                if (perfume.imagem) {
                    imageHtml = `<img src="${perfume.imagem}" alt="${perfume.nome}" class="w-full h-40 object-cover rounded-lg mb-4">`;
                } else {
                    imageHtml += `<i data-feather="package" class="text-gray-400 w-12 h-12"></i></div>`;
                }
                
                card.innerHTML = `
                    ${imageHtml}
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-lg font-bold text-gray-800">${perfume.nome}</h3>
                        <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded">${perfume.categoria}</span>
                    </div>
                    <p class="text-gray-600 mb-1">${perfume.marca} - ${perfume.ml}ml</p>
                    <p class="text-lg font-bold text-purple-600 mb-4">R$ ${perfume.preco.toFixed(2).replace('.', ',')}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-sm ${perfume.estoque > 0 ? 'text-green-600' : 'text-red-600'}">
                            ${perfume.estoque > 0 ? `${perfume.estoque} em estoque` : 'Esgotado'}
                        </span>
                        <div class="flex space-x-2">
                            <button onclick="editPerfume(${perfume.id})" class="text-blue-600 hover:text-blue-800">
                                <i data-feather="edit" class="w-5 h-5"></i>
                            </button>
                            <button onclick="deletePerfume(${perfume.id})" class="text-red-600 hover:text-red-800">
                                <i data-feather="trash-2" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            feather.replace();
        }

        // Update stats
        function updateStats() {
            const totalItems = perfumes.reduce((sum, perfume) => sum + perfume.estoque, 0);
            const totalValue = perfumes.reduce((sum, perfume) => sum + (perfume.preco * perfume.estoque), 0);
            const totalProducts = perfumes.length;
            
            document.getElementById('totalItems').textContent = totalItems;
            document.getElementById('totalValue').textContent = `R$ ${totalValue.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalProducts').textContent = totalProducts;
        }

        // SALES FUNCTIONS

        // Update sales product options
        function updateSalesProductOptions() {
            const select = document.getElementById('saleProduct');
            select.innerHTML = '<option value="">Selecione um perfume</option>';
            
            perfumes.forEach(perfume => {
                const option = document.createElement('option');
                option.value = perfume.id;
                option.textContent = `${perfume.nome} - ${perfume.marca} (${perfume.ml}ml) - R$ ${perfume.preco.toFixed(2)}`;
                select.appendChild(option);
            });
        }

        // Calculate sale total
        function calculateSaleTotal() {
            const productId = document.getElementById('saleProduct').value;
            const quantityValue = document.getElementById('saleQuantity').value;
            const priceValue = document.getElementById('salePrice').value;
            
            const quantity = parseInt(quantityValue) || 1;
            let price = parseFloat(priceValue);
            
            // Validate numeric inputs
            if (quantityValue && isNaN(quantity)) {
                alert('A quantidade deve ser um número válido');
                document.getElementById('saleQuantity').value = '1';
                return;
            }
            
            if (priceValue && isNaN(price)) {
                alert('O preço deve ser um número válido');
                document.getElementById('salePrice').value = '';
                return;
            }
            
            // If price is not set, use product price
            if (!price && productId) {
                const product = perfumes.find(p => p.id === parseInt(productId));
                if (product) {
                    price = product.preco;
                    document.getElementById('salePrice').value = price.toFixed(2);
                }
            }
            
            const total = price * quantity;
            document.getElementById('saleTotal').textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
            
            // Recalculate final total if needed
            calculateFinalTotal();
        }

        // Toggle card fields
        function toggleCardFields() {
            const method = document.getElementById('paymentMethod').value;
            const isCard = method === 'Cartão de Crédito' || method === 'Cartão de Débito';
            
            document.getElementById('installmentsField').classList.toggle('hidden', !isCard);
            document.getElementById('feeField').classList.toggle('hidden', !isCard);
            document.getElementById('finalTotalField').classList.toggle('hidden', !isCard);
            document.getElementById('totalWithFee').classList.toggle('hidden', !isCard);
            
            if (isCard) {
                calculateFinalTotal();
            }
        }

        // Calculate final total with fees
        function calculateFinalTotal() {
            const method = document.getElementById('paymentMethod').value;
            const isCard = method === 'Cartão de Crédito' || method === 'Cartão de Débito';
            
            if (!isCard) return;
            
            const totalText = document.getElementById('saleTotal').textContent;
            const installmentsValue = document.getElementById('installments').value;
            const feeValue = document.getElementById('cardFee').value;
            
            const total = parseFloat(totalText.replace('R$ ', '').replace(',', '.'));
            const installments = parseInt(installmentsValue);
            const fee = parseFloat(feeValue) || 0;
            
            // Validate numeric inputs
            if (isNaN(total)) {
                alert('O valor total não é um número válido');
                return;
            }
            
            if (installmentsValue && isNaN(installments)) {
                alert('O número de parcelas deve ser um número válido');
                document.getElementById('installments').value = '1';
                return;
            }
            
            if (feeValue && isNaN(fee)) {
                alert('A taxa deve ser um número válido');
                document.getElementById('cardFee').value = '0';
                return;
            }
            
            const feeAmount = total * (fee / 100);
            const finalTotal = total + feeAmount;
            
            document.getElementById('finalTotal').value = `R$ ${finalTotal.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalWithFee').textContent = `Total com taxa: R$ ${finalTotal.toFixed(2).replace('.', ',')} (${installments}x de R$ ${(finalTotal / installments).toFixed(2).replace('.', ',')})`;
            document.getElementById('totalWithFee').classList.remove('hidden');
        }

        // Process sale
        function processSale() {
            const productId = document.getElementById('saleProduct').value;
            const quantityValue = document.getElementById('saleQuantity').value;
            const priceValue = document.getElementById('salePrice').value;
            
            const quantity = parseInt(quantityValue) || 1;
            const price = parseFloat(priceValue);
            
            // Validate numeric inputs
            if (quantityValue && isNaN(quantity)) {
                alert('A quantidade deve ser um número válido');
                return;
            }
            
            if (!priceValue || isNaN(price)) {
                alert('O preço deve ser um número válido');
                return;
            }
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const customerInstagram = document.getElementById('customerInstagram').value.trim();
            const customerEmail = document.getElementById('customerEmail').value.trim();
            const postedInstagram = document.getElementById('postedInstagram').value;
            const salesChannel = document.getElementById('salesChannel').value;
            const deliveryLocation = document.getElementById('deliveryLocation').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            const installments = document.getElementById('installments').value;
            const cardFee = document.getElementById('cardFee').value;
            const saleNotes = document.getElementById('saleNotes').value.trim();
            
            // Validation
            if (!productId || !price || !customerName) {
                alert('Por favor, preencha pelo menos o produto, preço e nome do cliente');
                return;
            }
            
            const product = perfumes.find(p => p.id === parseInt(productId));
            if (!product) {
                alert('Produto não encontrado');
                return;
            }
            
            if (product.estoque < quantity) {
                alert(`Quantidade em estoque insuficiente. Disponível: ${product.estoque}`);
                return;
            }
            
            // Update product stock
            product.estoque -= quantity;
            
            // Create sale object
            const sale = {
                id: vendasIdCounter++,
                productId: parseInt(productId),
                productName: product.nome,
                productBrand: product.marca,
                quantity,
                unitPrice: price,
                total: price * quantity,
                customerName,
                customerPhone,
                customerInstagram,
                customerEmail,
                postedInstagram,
                salesChannel,
                deliveryLocation,
                paymentMethod,
                installments: paymentMethod === 'Cartão de Crédito' ? installments : 1,
                cardFee: paymentMethod === 'Cartão de Crédito' ? cardFee : 0,
                saleNotes,
                date: new Date().toISOString()
            };
            
            // Add to sales array
            vendas.push(sale);
            salvarDados();
            
            // Update UI
            updateStats();
            renderPerfumes();
            updateSalesStats();
            renderSales();
            clearSalesForm();
            
            alert('Venda registrada com sucesso!');
        }

        // Clear sales form
        function clearSalesForm() {
            document.getElementById('saleProduct').value = '';
            document.getElementById('saleQuantity').value = '1';
            document.getElementById('salePrice').value = '';
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerInstagram').value = '';
            document.getElementById('customerEmail').value = '';
            document.getElementById('postedInstagram').value = 'Não';
            document.getElementById('salesChannel').value = 'Instagram';
            document.getElementById('deliveryLocation').value = 'Retirada na Loja';
            document.getElementById('paymentMethod').value = 'PIX';
            document.getElementById('installments').value = '1';
            document.getElementById('cardFee').value = '0';
            document.getElementById('saleNotes').value = '';
            document.getElementById('saleTotal').textContent = 'R$ 0,00';
            document.getElementById('totalWithFee').textContent = '';
            document.getElementById('totalWithFee').classList.add('hidden');
            document.getElementById('installmentsField').classList.add('hidden');
            document.getElementById('feeField').classList.add('hidden');
            document.getElementById('finalTotalField').classList.add('hidden');
        }

        // Update sales stats
        function updateSalesStats() {
            const today = new Date().toISOString().split('T')[0];
            const todaySales = vendas.filter(sale => sale.date.split('T')[0] === today)
                                   .reduce((sum, sale) => sum + sale.total, 0);
            
            const totalSales = vendas.reduce((sum, sale) => sum + sale.total, 0);
            const itemsSold = vendas.reduce((sum, sale) => sum + sale.quantity, 0);
            const uniqueCustomers = [...new Set(vendas.map(sale => sale.customerName))].length;
            
            document.getElementById('salesToday').textContent = `R$ ${todaySales.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalSales').textContent = `R$ ${totalSales.toFixed(2).replace('.', ',')}`;
            document.getElementById('itemsSold').textContent = itemsSold;
            document.getElementById('totalCustomers').textContent = uniqueCustomers;
        }

        // Render sales
        function renderSales() {
            const tbody = document.getElementById('salesTableBody');
            tbody.innerHTML = '';
            
            if (vendas.length === 0) {
                document.getElementById('emptySalesState').classList.remove('hidden');
                return;
            } else {
                document.getElementById('emptySalesState').classList.add('hidden');
            }
            
            vendas.forEach(sale => {
                const date = new Date(sale.date);
                const formattedDate = date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50';
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formattedDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${sale.customerName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${sale.productName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${sale.quantity}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600">R$ ${sale.total.toFixed(2).replace('.', ',')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${sale.salesChannel}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${sale.paymentMethod}${sale.installments > 1 ? ` (${sale.installments}x)` : ''}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <button onclick="showSaleDetails(${sale.id})" class="text-purple-600 hover:text-purple-900 mr-3">
                            <i data-feather="eye" class="w-4 h-4"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            feather.replace();
        }

        // Filter sales
        function filterSales() {
            const searchTerm = document.getElementById('salesSearchInput').value.toLowerCase();
            const channel = document.getElementById('salesChannelFilter').value;
            const payment = document.getElementById('paymentFilter').value;
            
            const filtered = vendas.filter(sale => {
                const matchesSearch = sale.customerName.toLowerCase().includes(searchTerm) || 
                                     sale.productName.toLowerCase().includes(searchTerm);
                const matchesChannel = channel === 'Todos' || sale.salesChannel === channel;
                const matchesPayment = payment === 'Todos' || sale.paymentMethod === payment;
                return matchesSearch && matchesChannel && matchesPayment;
            });
            
            renderFilteredSales(filtered);
        }

        // Render filtered sales
        function renderFilteredSales(filteredSales) {
            const tbody = document.getElementById('salesTableBody');
            tbody.innerHTML = '';
            
            if (filteredSales.length === 0) {
                document.getElementById('emptySalesState').classList.remove('hidden');
                return;
            } else {
                document.getElementById('emptySalesState').classList.add('hidden');
            }
            
            filteredSales.forEach(sale => {
                const date = new Date(sale.date);
                const formattedDate = date.toLocaleDateString('pt-BR') + ' ' + date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50';
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formattedDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${sale.customerName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${sale.productName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${sale.quantity}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600">R$ ${sale.total.toFixed(2).replace('.', ',')}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${sale.salesChannel}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${sale.paymentMethod}${sale.installments > 1 ? ` (${sale.installments}x)` : ''}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <button onclick="showSaleDetails(${sale.id})" class="text-purple-600 hover:text-purple-900 mr-3">
                            <i data-feather="eye" class="w-4 h-4"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            feather.replace();
        }

        // Show sale details modal
        function showSaleDetails(id) {
            const sale = vendas.find(s => s.id === id);
            if (!sale) return;
            
            const date = new Date(sale.date);
            const formattedDate = date.toLocaleDateString('pt-BR') + ' às ' + date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            
            const modalContent = document.getElementById('saleModalContent');
            modalContent.innerHTML = `
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="text-sm font-medium text-gray-500">Data da Venda</h4>
                            <p class="mt-1 text-sm text-gray-900">${formattedDate}</p>
                        </div>
                        <div>
                            <h4 class="text-sm font-medium text-gray-500">Valor Total</h4>
                            <p class="mt-1 text-lg font-bold text-green-600">R$ ${sale.total.toFixed(2).replace('.', ',')}</p>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-200 pt-4">
                        <h4 class="text-sm font-medium text-gray-500">Produto</h4>
                        <p class="mt-1 text-sm text-gray-900">${sale.productName} - ${sale.productBrand}</p>
                        <p class="mt-1 text-sm text-gray-900">Quantidade: ${sale.quantity}</p>
                        <p class="mt-1 text-sm text-gray-900">Preço unitário: R$ ${sale.unitPrice.toFixed(2).replace('.', ',')}</p>
                    </div>
                    
                    <div class="border-t border-gray-200 pt-4">
                        <h4 class="text-sm font-medium text-gray-500">Cliente</h4>
                        <p class="mt-1 text-sm text-gray-900">${sale.customerName}</p>
                        ${sale.customerPhone ? `<p class="mt-1 text-sm text-gray-900">Telefone: ${sale.customerPhone}</p>` : ''}
                        ${sale.customerInstagram ? `<p class="mt-1 text-sm text-gray-900">Instagram: ${sale.customerInstagram}</p>` : ''}
                        ${sale.customerEmail ? `<p class="mt-1 text-sm text-gray-900">Email: ${sale.customerEmail}</p>` : ''}
                        <p class="mt-1 text-sm text-gray-900">Postou no Instagram? ${sale.postedInstagram}</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-gray-200 pt-4">
                        <div>
                            <h4 class="text-sm font-medium text-gray-500">Canal de Venda</h4>
                            <p class="mt-1 text-sm text-gray-900">${sale.salesChannel}</p>
                        </div>
                        <div>
                            <h4 class="text-sm font-medium text-gray-500">Local de Entrega</h4>
                            <p class="mt-1 text-sm text-gray-900">${sale.deliveryLocation}</p>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-200 pt-4">
                        <h4 class="text-sm font-medium text-gray-500">Pagamento</h4>
                        <p class="mt-1 text-sm text-gray-900">${sale.paymentMethod}${sale.installments > 1 ? ` (${sale.installments}x)` : ''}</p>
                        ${sale.cardFee > 0 ? `<p class="mt-1 text-sm text-gray-900">Taxa: ${sale.cardFee}%</p>` : ''}
                    </div>
                    
                    ${sale.saleNotes ? `
                    <div class="border-t border-gray-200 pt-4">
                        <h4 class="text-sm font-medium text-gray-500">Observações</h4>
                        <p class="mt-1 text-sm text-gray-900">${sale.saleNotes}</p>
                    </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('saleModal').classList.remove('hidden');
        }

        // Close sale modal
        function closeSaleModal() {
            document.getElementById('saleModal').classList.add('hidden');
        }
    
        // Salvar e carregar dados com localStorage
        function salvarDados() {
            localStorage.setItem('perfumes', JSON.stringify(perfumes));
            localStorage.setItem('vendas', JSON.stringify(vendas));
            localStorage.setItem('perfumeIdCounter', perfumeIdCounter.toString());
            localStorage.setItem('vendasIdCounter', vendasIdCounter.toString());
        }

        function carregarDados() {
            const perfumesSalvos = localStorage.getItem('perfumes');
            const vendasSalvas = localStorage.getItem('vendas');
            const perfumeId = localStorage.getItem('perfumeIdCounter');
            const vendasId = localStorage.getItem('vendasIdCounter');

            if (perfumesSalvos) perfumes = JSON.parse(perfumesSalvos);
            if (vendasSalvas) vendas = JSON.parse(vendasSalvas);
            
            // Validate counters after parsing
            if (perfumeId) {
                const parsedPerfumeId = parseInt(perfumeId);
                if (!isNaN(parsedPerfumeId)) {
                    perfumeIdCounter = parsedPerfumeId;
                }
            }
            
            if (vendasId) {
                const parsedVendasId = parseInt(vendasId);
                if (!isNaN(parsedVendasId)) {
                    vendasIdCounter = parsedVendasId;
                }
            }
        }

    </script>
</body>
</html>